<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="css/profile.css">
</head>
<body>

    <div id="menu-btn">â˜°</div>

    <div id="sideMenu">
        <ul>
            <li><a href="profile_page.html">Profile</a></li>
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="index.html">Home</a></li>
            <li><a href="calculator_page.html">Calculator</a></li>
            <li><a href="login.html">Logout</a></li>
        </ul>
    </div>

    <div class="profile-container">
        <img src="css/pogi.jpg" class="profile-img" alt="profile">

        <h2 id="userDisplay">Guest User</h2>

        <div class="form-box">
            <input type="text" id="fullName" placeholder="Full Name">
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="******">
            <input type="email" id="email" placeholder="Email">
            <button id="saveProfile">Edit</button>
        </div>
    </div>

    <script src="js/menu.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/supabase-config.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const user = await supabase.auth.getUser();
            if (user && user.data?.user) {
                const u = user.data.user;
                document.getElementById("userDisplay").textContent = u.user_metadata?.full_name || "User";
                document.getElementById("fullName").value = u.user_metadata?.full_name || "";
                document.getElementById("username").value = u.user_metadata?.username || "";
                document.getElementById("email").value = u.email;
            }
        });

        document.getElementById("saveProfile").addEventListener("click", async () => {
            const fullName = document.getElementById("fullName").value;
            const username = document.getElementById("username").value;

            const { error } = await supabase.auth.updateUser({
                data: {
                    full_name: fullName,
                    username: username
                }
            });

            if (!error) {
                alert("Profile updated successfully!");
                document.getElementById("userDisplay").textContent = fullName || "User";
            } else {
                alert("Failed to update profile.");
            }
        });
    </script>
<script>
document.addEventListener("DOMContentLoaded", async () => {
    const { data } = await supabase.auth.getUser();
    const user = data?.user;

    if (!user) {
        window.location.href = "login.html";
        return;
    }

    document.getElementById("userDisplay").textContent =
        user.user_metadata?.full_name || "User";

    document.getElementById("fullName").value =
        user.user_metadata?.full_name || "";

    document.getElementById("username").value =
        user.user_metadata?.username || "";

    document.getElementById("email").value = user.email;
});

document.getElementById("saveProfile").addEventListener("click", async () => {
    const fullName = document.getElementById("fullName").value;
    const username = document.getElementById("username").value;
    const newEmail = document.getElementById("email").value;
    const newPassword = document.getElementById("password").value;

    let updateData = {
        data: {
            full_name: fullName,
            username: username
        }
    };

    if (newEmail.trim() !== "") {
        updateData.email = newEmail;
    }

    if (newPassword.trim() !== "") {
        updateData.password = newPassword;
    }

    const { error } = await supabase.auth.updateUser(updateData);

    if (!error) {
        alert("Profile updated successfully!");
        document.getElementById("userDisplay").textContent = fullName || "User";
    } else {
        alert("Failed to update profile.");
    }
});
</script>

</body>
</html>
